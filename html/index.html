<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title> Data Cleansing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" media="all" href="styles.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  </head>
  <script src="react.js"></script>
  <script src="react-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>

  <body>
    <div class="jumbotron">
      <div id="upload">
      </div>
    </div>
  <script type="text/babel">


    var Upload = React.createClass({
      componentDidMount: function() {
        if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
           var dd = document.getElementById("draganddrop");
           console.log(dd)
           var fs = document.getElementById("fileselect")
           var xhr = new XMLHttpRequest();
           if (xhr.upload) {
            dd.addEventListener("dragover", this.fileDragHover, false);
       			dd.addEventListener("dragleave", this.fileDragHover, false);
       			dd.addEventListener("drop", this.addFile, false);
       			dd.style.display = "block";
           }
        } else {
        alert('The File APIs are not fully supported in this browser.');
        }

      },
      getInitialState: function () {
        return {files: []};
      },

      fileDragHover: function(e) {
        console.log("FILEDRAGHOVER")
    		e.stopPropagation();
    		e.preventDefault();
    		e.target.className = (e.type == "dragover" ? "hover" : "");
    	},

      addFile: function (e) {
        console.log("addFile")
        this.fileDragHover(e);
        var files = e.target.files || e.dataTransfer.files;
        for (var i = 0, f; f = files[i]; i++) {
    			this.state.files.push(f);
    		}
      },
      printFiles: function () {
        for  (var i = 0; i < this.state.files.length; i++ ) {
            console.log(this.state.files[i]);
        }
      },
      uploadToServer: function () {
        var formData = new FormData();
        for  (var i = 0; i < this.state.files.length; i++ ) {
            formData.append('file'+i, this.state.files[i]);
        }

        $.ajax({
          //dataType: 'json',
          type: "POST",
          url: "/process",
          data: formData,
          processData: false,  // tell jQuery not to process the data
          contentType: false,  // tell jQuery not to set contentType
          success: function (res) {
            console.log(res);
          },
          error: function (t, b, err) {
            console.log(t);
          }
        });
      },
      render: function() {
        return (<div>
                    <fieldset>
                  	<input type="file" id={this.props.id} name="fileselect[]" onChange={this.addFile} multiple="multiple" /> <br  />
                    <div id="draganddrop">or drop files here</div> <br />
                    <button type="button" className="btn btn-info" onClick={this.uploadToServer}>Upload</button>
                    <button type="button" onClick={this.printFiles}>Print</button>
                    </fieldset>
                </div>);
      }

    });



    ReactDOM.render(<Upload id="fileselect"/>,  document.getElementById('upload'));
  </script>

  </body>
</html>
